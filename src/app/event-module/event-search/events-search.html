<div class="events-content">
  <!-- Header -->
  <div class="header">
    <ion-button fill="clear" class="back-button" (click)="goBack()">
      <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
    </ion-button>
    <h1 class="header-title">Events</h1>
    <!-- Added filter button to navigate to format-choice -->
    <ion-button fill="clear" class="filter-button" (click)="openFilters()">
      <ion-icon name="options-outline" slot="icon-only"></ion-icon>
    </ion-button>
  </div>

  <!-- Removed category-filters section -->

  <!-- Map Container -->
  <div class="map-section">
    <div #mapContainer class="map-container"></div>
    <ion-button class="full-map-button" fill="clear" (click)="openFullMap()">
      <ion-icon name="expand" slot="start"></ion-icon>
      Full Map
    </ion-button>
  </div>

  <!-- Events/Groups List -->
  <div class="events-section">
    <div class="section-header">
      <h2>Upcoming</h2>
      <ion-segment [value]="selectedSegment" (ionChange)="onSegmentChange($event)" class="events-segment">
        <ion-segment-button value="events">
          <ion-label>Events</ion-label>
        </ion-segment-button>
        <ion-segment-button value="groups">
          <ion-label>Groups</ion-label>
        </ion-segment-button>
      </ion-segment>
    </div>

    <!-- Show events list when Events segment is selected -->
    @if (selectedSegment === 'events') {
      <div class="events-list">
        @for (event of events; track event.id; let i = $index) {
          <app-event-card
            [event]="event"
            [cardId]="'event-' + event.id"
            [id]="'event-' + event.id"
            (click)="navigateToEventDetail(event)"
          ></app-event-card>
        } @empty {
          <div class="empty">Nessun evento trovato</div>
        }
      </div>
    }

    <!-- Show users and groups list when Groups segment is selected -->
    @if (selectedSegment === 'groups') {
      <div class="groups-list">
        <!-- User Cards -->
        @for (user of users; track user.id) {
          <div 
            class="user-card" 
            [id]="'user-' + user.id" 
            [style.border-color]="user.color + '20'"
            [style.box-shadow]="'0 0 15px rgba(' + getRgbFromHex(user.color) + ', 0.3)'"
            (click)="openUserProfile(user.id)">
            <img [src]="user.imageUrl" [alt]="user.name" class="user-avatar" />
            <div class="user-info">
              <h3 class="user-name">{{ user.name }}</h3>
              <p class="user-username">{{ user.username }}</p>
              <div class="user-meta">
                <span class="user-distance">
                  <ion-icon name="location-outline"></ion-icon>
                  {{ user.distance }}km
                </span>
                @if (user.commonInterests) {
                  <span class="user-interests">
                    <ion-icon name="heart-outline"></ion-icon>
                    {{ user.commonInterests }} interessi
                  </span>
                }
              </div>
            </div>
            <div class="user-actions">
              <ion-button fill="clear" class="action-button spark-button" (click)="$event.stopPropagation()">
                <ion-icon name="flash" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        }

        <!-- Group Cards -->
        @for (group of groups; track group.id) {
          <div 
            class="group-card" 
            [id]="'group-' + group.id" 
            [style.border-color]="group.color + '20'"
            [style.box-shadow]="'0 0 15px rgba(' + getRgbFromHex(group.color) + ', 0.3)'">
            <img [src]="group.imageUrl" [alt]="group.name" class="group-image" />
            <div class="group-info">
              <h3 class="group-name">{{ group.name }}</h3>
              <div class="group-members">
                @for (member of group.members.slice(0, 3); track member.id) {
                  <img 
                    [src]="member.imageUrl" 
                    [alt]="'Member ' + member.id" 
                    class="member-avatar"
                    (click)="openUserProfile(member.id); $event.stopPropagation()"
                  />
                }
                @if (group.totalMembers > 3) {
                  <span class="members-count">+{{ group.totalMembers - 3 }}</span>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

</div>
