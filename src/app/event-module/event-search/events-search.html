<div class="events-content">
  <!-- Header -->
  <div class="header">
    <ion-button fill="clear" class="back-button" (click)="goBack()">
      <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
    </ion-button>
    <h1 class="header-title">Events</h1>
    <!-- Added filter button to navigate to format-choice -->
    <ion-button fill="clear" class="filter-button" (click)="openFilters()">
      <ion-icon name="options-outline" slot="icon-only"></ion-icon>
    </ion-button>
  </div>

  <!-- Removed category-filters section -->

  <!-- Map Container -->
  <div class="map-section">
    <div #mapContainer class="map-container"></div>
    <ion-button class="full-map-button" fill="clear" (click)="openFullMap()">
      <ion-icon name="expand" slot="start"></ion-icon>
      Full Map
    </ion-button>
  </div>

  <!-- Events/Groups List -->
  <div class="events-section">
    <div class="section-header">
      <h2>Upcoming</h2>
      <!-- Replaced ion-segment with custom styled toggle like in my-pulse -->
      <div class="events-groups-toggle">
        <div class="toggle-slider" [style.transform]="selectedSegment === 'groups' ? 'translateX(100%)' : 'translateX(0)'"></div>
        <button 
          class="toggle-button" 
          [class.active]="selectedSegment === 'events'"
          (click)="onSegmentChange({detail: {value: 'events'}})">
          Events
        </button>
        <button 
          class="toggle-button" 
          [class.active]="selectedSegment === 'groups'"
          (click)="onSegmentChange({detail: {value: 'groups'}})">
          Groups
        </button>
      </div>
    </div>

    <!-- Show events list when Events segment is selected -->
    @if (selectedSegment === 'events') {
      <div class="events-list">
        @for (event of events; track event.id; let i = $index) {
          <app-event-card
            [event]="event"
            [cardId]="'event-' + event.id"
            [id]="'event-' + event.id"
            (click)="navigateToEventDetail(event)"
          ></app-event-card>
        } @empty {
          <div class="empty">Nessun evento trovato</div>
        }
      </div>
    }

    <!-- Show users and groups list when Groups segment is selected -->
    @if (selectedSegment === 'groups') {
      <div class="groups-list">
        <!-- Updated user card design with neon border, progress bar, and improved layout -->
        @for (user of users; track user.id) {
          <div 
            class="user-card" 
            [id]="'user-' + user.id" 
            (click)="openUserProfile(user.id)">
            <div class="user-avatar-container">
              <img [src]="user.imageUrl" [alt]="user.name" class="user-avatar" [style.border-color]="user.color" />
            </div>
            <div class="user-info">
              <h3 class="user-name">{{ user.name }}</h3>
              <p class="user-username">{{ user.username }}</p>
              <!-- Removed commonInterests, keeping only distance -->
              <div class="user-meta">
                <span class="user-distance">
                  <ion-icon name="location-outline"></ion-icon>
                  {{ user.distance }}km
                </span>
              </div>
            </div>
            <!-- Removed progress bar completely -->
          </div>
        }

        <!-- Updated group card with rounded square image and overlapping member avatars -->
        @for (group of groups; track group.id) {
          <div 
            class="group-card" 
            [id]="'group-' + group.id">
            <div class="group-image-container">
              <img [src]="group.imageUrl" [alt]="group.name" class="group-image" [style.border-color]="group.color" />
            </div>
            <div class="group-info">
              <h3 class="group-name">{{ group.name }}</h3>
              <div class="group-members">
                @for (member of group.members.slice(0, 3); track member.id) {
                  <img 
                    [src]="member.imageUrl" 
                    [alt]="'Member ' + member.id" 
                    class="member-avatar"
                    (click)="openUserProfile(member.id); $event.stopPropagation()"
                  />
                }
                @if (group.totalMembers > 3) {
                  <div class="members-count">
                    <span>+{{ group.totalMembers - 3 }}</span>
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

</div>
