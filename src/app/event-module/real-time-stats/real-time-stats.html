<ion-header class="ion-no-border header-blur">
  <ion-toolbar color="dark">
    <ion-buttons slot="start">
      <ion-button fill="clear" (click)="back()">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title class="title-wrap">
      <div class="title">Milano Summer Fest</div>
      <div class="subtitle">Live Stats <span class="dot">•</span></div>
    </ion-title>

    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="close()">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="page-bg">
  <!-- Updated section spacing and structure to match template proportions -->
  <div class="main-content">
    <!-- Amici e Gruppi -->
    <section>
      <h2 class="section-title">Amici e Gruppi</h2>
      <ion-card class="card">
        <ion-card-content class="card-content">
          <div>
            <div class="flex-between-baseline">
              <h3 class="card-title">Persone e gruppi preferiti sul posto</h3>
              <span class="count-badge">{{ statsData.attendees.onSite }}</span>
            </div>
            <div class="avatars-container">
              <ng-container *ngFor="let url of onSiteAvatars">
                <img [src]="url" class="avatar avatar-solid" alt="avatar" />
              </ng-container>
              <div class="avatar avatar-more">+18</div>
            </div>
          </div>

          <div class="section-divider"></div>

          <div>
            <div class="flex-between-baseline">
              <h3 class="card-title">In arrivo</h3>
              <span class="count-badge">{{ statsData.attendees.arriving }}</span>
            </div>
            <div class="avatars-container">
              <ng-container *ngFor="let url of arrivingAvatars">
                <img [src]="url" class="avatar avatar-dashed" alt="avatar" />
              </ng-container>
              <div class="avatar avatar-more avatar-dashed">+4</div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </section>

    <!-- Panoramica -->
    <section>
      <h2 class="section-title">Panoramica</h2>
      <div class="overview-grid">
        <ion-card class="card overview-full">
          <ion-card-content class="card-content">
            <p class="stat-label">Vibe adesso</p>
            <p class="stat-value-xl">{{ statsData.vibe }}</p>
          </ion-card-content>
        </ion-card>

        <ion-card class="card">
          <ion-card-content class="card-content">
            <p class="stat-label">Tempo per arrivare</p>
            <p class="stat-value-lg">{{ statsData.travelTime }}</p>
          </ion-card-content>
        </ion-card>

        <ion-card class="card">
          <ion-card-content class="card-content">
            <p class="stat-label">Ingresso</p>
            <div class="chip chip-green">
              <ion-icon name="ticket-outline"></ion-icon> Gratuito
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="card">
          <ion-card-content class="card-content">
            <p class="stat-label">Disponibilità</p>
            <div class="chip chip-green">
              <ion-icon name="checkmark-circle-outline"></ion-icon> {{ statsData.availability }}
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="card">
          <ion-card-content class="card-content">
            <p class="stat-label">Prezzo indicativo</p>
            <div class="chip chip-green">{{ statsData.pricing }}</div>
          </ion-card-content>
        </ion-card>
      </div>
    </section>

    <!-- Valutazioni -->
    <section>
      <h2 class="section-title">Valutazioni</h2>
      <ion-card class="card">
        <ion-card-content class="card-content ratings-content">
          <div>
            <div class="flex-between-center">
              <p class="stat-label">Valutazione Media</p>
              <p class="rating-value">{{ statsData.ratings.average }} <span class="rating-max">/ 5</span></p>
            </div>
            <div class="bar-container">
              <div *ngFor="let full of getRatingSegments(statsData.ratings.average)" 
                   class="bar-segment" 
                   [class.bar-segment-active]="full"></div>
            </div>
          </div>

          <div>
            <div class="flex-between-center">
              <p class="stat-label">Valutazione persone o gruppi preferiti</p>
              <p class="rating-value-green">{{ statsData.ratings.favorites }} <span class="rating-max">/ 5</span></p>
            </div>
            <div class="bar-container">
              <div *ngFor="let _ of getRatingSegments(5)" class="bar-segment bar-segment-green"></div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </section>

    <!-- Calore -->
    <section>
      <h2 class="section-title">Calore</h2>
      <ion-card class="card">
        <ion-card-content class="card-content heat-content">
          <p class="stat-label heat-label">Questo evento vs altri stasera</p>
          <div class="heat-icons">
            <ion-icon
              *ngFor="let on of getHeatArray(); let i = index"
              name="flame-outline"
              [class.heat-active]="i === 0"
            ></ion-icon>
          </div>
          <p class="heat-status">Meno caldo</p>
        </ion-card-content>
      </ion-card>
    </section>

    <!-- Lista artisti -->
    <section>
      <h2 class="section-title">Lista artisti</h2>
      <ion-card class="card">
        <ion-card-content class="card-content artists-content">
          <div class="artist-current">
            <p class="artist-status">
              <ion-icon name="wifi-outline" class="status-icon"></ion-icon> IN CORSO
            </p>
            <p class="artist-name">{{ statsData.currentArtist }}</p>
            <p class="artist-time">Main Stage - 22:00 - 23:00</p>
          </div>

          <div class="artist-upcoming">
            <p class="artist-name-upcoming">{{ statsData.nextArtist }}</p>
            <p class="artist-time">Main Stage - 23:15 - 00:30</p>
          </div>

          <div class="artist-upcoming">
            <p class="artist-name-upcoming">Opening Act</p>
            <p class="artist-time">Second Stage - 21:00 - 21:45</p>
          </div>
        </ion-card-content>
      </ion-card>
    </section>

    <section>
      <div class="footer-text">
        <p>Dati aggiornati 1 min fa. Pull-to-refresh per aggiornare.</p>
      </div>
    </section>
  </div>

</ion-content>
